<div class="container mt-4 mb-4">
    <div class="row d-flex justify-content-center">
      <div class="col-md-12">
        <div class="card card-event p-3 py-4">

          <div class="row g-3">
            <div class="col-md-8">
              <img src="<%= @event_data[:image] %>" class="img-fluid">
              <div class="mt-2">
                <h1><%= @event_data[:title] %></h1>
                <p><%= @event_data[:description] %></p>
              </div>
            </div>

            <div class="col-md-4 text-center">
              <a href="#" target="_blank"><h4><strong>Organizzatore</strong></h4></a>

              <div class="row mt-1">
                <div>
                  <% if @user_like == true %>
                    <label> 
                      <%= button_to like_events_path, :method => :post, disabled: !user_signed_in?, class: "like-event btn link-primary", params: { like_event: {event_id: event.id, promoter: event.organizer_id, like: true} } do %>
                        <i class="fa-regular fa-thumbs-up fa-6" style="font-size: 2em; color: yellow !important"></i>
                      <%end%>
                    </label>
                    <label>
                      <%= button_to like_events_path, :method => :post, disabled: !user_signed_in?, class: "like-event btn link-primary", params: { like_event: {event_id: event.id, promoter: event.organizer_id, like: false} } do %>
                        <i class="fa-regular fa-thumbs-down fa-6" style="font-size: 2em;"></i>
                      <%end%>
                    </label>

                  <%elsif @user_like == false %>
                    <label> 
                      <%= button_to like_events_path, :method => :post, disabled: !user_signed_in?, class: "like-event btn link-primary", params: { like_event: {event_id: event.id, promoter: event.organizer_id, like: true} } do %>
                        <i class="fa-regular fa-thumbs-up fa-6" style="font-size: 2em;"></i>
                      <%end%>
                    </label>
                    <label>
                      <%= button_to like_events_path, :method => :post, disabled: !user_signed_in?, class: "like-event btn link-primary", params: { like_event: {event_id: event.id, promoter: event.organizer_id, like: false} } do %>
                        <i class="fa-regular fa-thumbs-down fa-6" style="font-size: 2em; color: yellow !important"></i>
                      <%end%>
                    </label>
                  
                  <%else%>
                    <label> 
                      <%= button_to like_events_path, :method => :post, disabled: !user_signed_in?, class: "like-event btn link-primary", params: { like_event: {event_id: event.id, promoter: event.organizer_id, like: true} } do %>
                        <i class="fa-regular fa-thumbs-up fa-6" style="font-size: 2em;"></i>
                      <%end%>
                    </label>
                    <label>
                      <%= button_to like_events_path, :method => :post, disabled: !user_signed_in?, class: "like-event btn link-primary", params: { like_event: {event_id: event.id, promoter: event.organizer_id, like: false} } do %>
                        <i class="fa-regular fa-thumbs-down fa-6" style="font-size: 2em;"></i>
                      <%end%>
                    </label>
                  <%end%>
                </div>
              </div>

              <strong class="mt-2">
                Like: <%=@sum_likes%>
              </strong>

              <div class="row mt-2">
                <div class="col mt-2">
                  <a class="share text-decoration-none text-black" target="_blank" href="https://web.whatsapp.com/send?text=">
                    <i class="fa-xl fa-brands fa-square-whatsapp" style="font-size: 2em;"></i>
                  </a>

                  <a class="share text-decoration-none text-black" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=">
                    <i class="fa-xl fa-brands fa-square-facebook" style="font-size: 2em;"></i>
                  </a>

                  <a class="share text-decoration-none text-black" target="_blank" href="https://twitter.com/intent/tweet?url=">
                    <i class="fa-xl fa-brands fa-square-twitter" style="font-size: 2em;"></i>
                  </a>
                </div>
              </div>

              <%= button_to @favorite_text, favorite_events_path, class: "mt-3 btn btn-secondary btn-block", disabled: !user_signed_in?, method: :post, params: { event: @event.id } %>

              <p class="mt-2"><strong><%= @where_event %></strong></p>

              <p class="mt-2">
                <a class="btn btn-secondary btn-block" target="_blank" href="https://www.google.it/maps/search/Hotels/@<%= event.coordinates.gsub(' ', '') %>,17z/data=!3m1!4b1">Visualizza Hotel nelle vicinanze</a>
              </p>

              <p class="mt-2">
                <strong>Data:</strong>
                <%= @event_data[:date] %>
              </p>

              <p class="mt-2">
                <!-- VARIABILI TEMPORANEE -->
                <%= link_to "Aggiungi a Google Calendar", "#{calendar_add_event_url}?event_name=#{@event_data[:title]}&location=#{@where_event}&start_date=2022-10-22T09:00:00-07:00&end_date=2022-10-28T09:00:00-07:00", class: "btn btn-secondary btn-block", target:"_blank"%>
              </p>

              <% if user_signed_in? %>
                <% if !session[:authorization].nil? %>
                  <div class="mt-2">
                  <%= form_with url: drive_add_media_url, multipart: true do |form| %>
                    <%= file_field_tag :media, id: "media", accept: "image/*,video/*" %>
                    <%= button_to "Carica", '', id: "upload_button", hidden: true, class: "mt-2 btn btn-secondary btn-block", method: :post, params: { event: @event.id} %>
                    <%= button_to "Disconnetti Google Drive", drive_logout_url, class: "mt-2 btn btn-secondary btn-block", method: :post %>
                  <% end %>
                  </div>
                <% else %>
                  <div class="mt-2">
                    <%= link_to "Collega Google Drive", drive_login_url, class: "mt-2 btn btn-secondary btn-block" %>
                  </div>
                <% end %>
              <% end %>

              <%= button_to "Partecipa", "#", class: "mt-3 btn btn-secondary btn-block", disabled: !user_signed_in?, method: :post, params: { event: @event.id } %>

              <p class="mt-2">
                <strong>Partecipanti:</strong> 0
              </p>

              <% if event.origin == "ticketmaster" %>
                <p class="mt-2">
                  <strong>Prezzo:</strong>
                  <%= @event_data[:price] %>
                </p>
                <p class="mt-2">
                  <%= link_to "Acquista", @event_data[:url], class: "btn btn-secondary btn-block", target: "_blank" %>
                </p>
              <% end %>

            </div>
          </div>


        </div>         
      </div>      
    </div>
  </div>

<script>
  document.querySelectorAll('.share').forEach(function(link) {
    link.href = link.href + location.href;
  });

  var file = document.getElementById("media").addEventListener('change', function() {
    document.getElementById("upload_button").hidden = false;
  });
</script>